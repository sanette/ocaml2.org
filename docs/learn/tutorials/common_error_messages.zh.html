<!DOCTYPE HTML>


<html xmlns="http://www.w3.org/1999/xhtml" lang="zh" xml:lang="zh">
  <head>
    <meta charset="utf-8"/>
    
    <link href="common_error_messages.html" rel="alternate" hreflang="en"/>
<link href="common_error_messages.fr.html" rel="alternate" hreflang="fr"/>
<link href="common_error_messages.ja.html" rel="alternate" hreflang="ja"/>
<link href="common_error_messages.zh.html" rel="alternate" hreflang="zh"/>

    
    <title>常见的错误信息 &#8211; OCaml</title>
    <link href="../../img/favicon32x32.ico?" rel="shortcut icon" type="image/x-icon"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    
    <link href="//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet"/>
    <link href="//fonts.googleapis.com/css?family=Domine:400,700" rel="stylesheet"/>
    <link href="//fonts.googleapis.com/css?family=Droid+Sans+Mono" rel="stylesheet" type="text/css"/>
    
    <link href="../../css/bootstrap.css" rel="stylesheet" media="screen"/>
    <link href="../../css/bootstrap_mod.css" rel="stylesheet" media="screen"/>
    <link href="../../css/ocamlorg.css" rel="stylesheet" media="screen"/>
    
    
    <script src="../../js/collapsed-menu.js" type="text/javascript"></script>
    
    
    <script>
      if (document.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#Image', '1.1')) {
      document.documentElement.className = 'svg';
      }
    </script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" onclick="toggleVisibilityMenu('menu-items')">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="../../" class="brand"><img src="../../img/colour-logo-white.svg" class="svg" alt="OCaml"/><img src="../../img/colour-logo-white.png" class="png" alt="OCaml"/></a>
          <div id="menu-items" class="nav-collapse collapse">
                        <ul class="nav">
              <li class="active"><a href="../../learn/">Learn</a></li>
              <li><a href="../../docs/">Documentation</a></li>
              <li><a href="https://opam.ocaml.org/">Packages</a></li>
              <li><a href="../../community/">Community</a></li>
              <li><a href="../../community/planet/">News</a></li>
            </ul>

            
            <a href="https://github.com/ocaml/ocaml.org/tree/master/site/learn/tutorials/common_error_messages.zh.md" title="Edit this page" class="edit-this-page pull-right"><span>Edit this page</span></a>
	    <script language="JavaScript">
	      // Preload the hover image
	      Image1= new Image(33,33);
	      Image1.src = '/img/edit-hover.svg';
	      Image2= new Image(33,33);
	      Image2.src = '/img/edit-hover.png';
	    </script>
            
            <form id="searchform" class="navbar-search pull-right" method="get" action="//www.google.com/search">
              <input type="hidden" name="as_sitesearch" value="ocaml.org"/>
              <input placeholder="Search" class="search-query" name="q" type="text"/>
            </form>
          </div>
        </div>
      </div>
      
    </nav>
    
    
<div class="container">
  <div class="row">
    
    <div class="span4"></div>
    <div class="span8">
      
<div class="running-header">
  
  <div class="row">
    <ol class="breadcrumb">
      <li><a href="../../">Home</a><span class="divider"></span></li>
<li><a href="../../learn/">Learn</a><span class="divider"></span></li>
<li><a href="../../learn/tutorials/index.zh.html">OCaml教程</a><span class="divider"></span></li>
<li class="active">常见的错误信息</li>


    </ol>
    <ul class="translations">
      <li><a href="common_error_messages.html">en</a></li>
<li><a href="common_error_messages.fr.html">fr</a></li>
<li><a href="common_error_messages.ja.html">日本語</a></li>
<li class="active">中文</li>

    </ul>
  </div>
  
</div>

    </div>
    <div class="span4">
      <nav id="nav-secondary">
        <ul class="nav nav-list">
          <li class="nav-header"><a href="#">Contents</a></li>
          <ul><li><a href="#">类型错误</a>
<ul><li><a href="#This-expression-has-type-but-is-here-used-with-type">This expression has type ... but is here used with type ...</a>
</li><li><a href="#This-optional-argument-cannot-be-erased">警告: This optional argument cannot be erased</a>
</li><li><a href="#The-type-of-this-expression-contains-type-variables-that-cannot-be-generalized">The type of this expression... contains type variables that cannot be generalized</a>
</li></ul>
</li><li><a href="#">模式匹配警告和错误</a>
<ul><li><a href="#This-pattern-is-unused">This pattern is unused</a>
</li><li><a href="#This-pattern-matching-is-not-exhaustive">This pattern-matching is not exhaustive</a>
</li></ul>
</li><li><a href="#Problems-recompiling-valid-programs">Problems recompiling valid programs</a>
<ul><li><a href="#x-cmi-is-not-a-compiled-interface">x.cmi is not a compiled interface</a>
</li><li><a href="#Warning-Illegal-backslash-escape-in-string">Warning: Illegal backslash escape in string</a>
</li></ul>
</li></ul>

        </ul>
      </nav>
    </div>
    <div id="content-primary" class="span8">
            <div id="tryocaml" class="content" style="display:none;">
        <div class="container">
          <div class="row">
            <div id="lesson-message"></div>
            <div id="languages" style="display:none;"></div>
            <div id="menu-lessons" style="display:none">
              <table class="zebra-striped">
                <tr><td id="text-x"><code></code></td> <td></td></tr>
              </table>
            </div>
            <div class="span9 ocaml">
              <div id="toplevel-container">
                <pre id="output"></pre>
                <div id="sharp">#</div>
                <div id="toplevel"></div>
              </div>
              <div id="buttons"></div>
              <div id="graphics-title"></div>
              <div id="graphics"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="main-contents" class="content">
        

<h1 id="">常见的错误信息</h1><p>这一章给大家一个关于OCaml编译器的一些错误或者警告信息的简要解释。详尽解释在本教程的
相应章节可以找到。</p>
<h2 id="">类型错误</h2><h3 id="This-expression-has-type-but-is-here-used-with-type">This expression has type ... but is here used with type ...</h3><p>当一个对象的类型与上下文要求的不匹配，你就会看到这个信息：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input">1 + <span class="ocaml-error-loc">2.5</span></span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-error">Error: This expression has type float but an expression was expected of type
         int
</span></code></pre>

<p>&quot;This expression has type <em>X</em> but is here used with type <em>Y</em>&quot; 的意思是
如果一个表达式的内容是隔离的 (2.5)，那么它的类型可以推导成 <em>X</em> (float)。但是上下文
告诉我们 (1 + ...) 应该是类型 <em>Y</em>
(int) 的，因而与 <em>X</em> 不匹配。</p>
<p>下面的信息更加糟糕：</p>
<pre class="text"><code class="text">This expression has type my_type but is here used with type my_type</code></pre><p>这个错误往往发生在一些toplevel中的类型定义上。在OCaml，重新定义一个已经存在的类型
是完全合法的。看看下面这个会话：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">type</span> <span class="type">my_type</span> = A | B</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>type my_type = A | B
</span><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let </span><span class="ocaml-variable">a</span> = A</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val a : my_type = A
</span><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">type</span> <span class="type">my_type</span> = A | B</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>type my_type = A | B
</span><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let </span><span class="ocaml-variable">b</span> = B</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val b : my_type = B
</span><span class="ocaml-prompt"># </span><span class="ocaml-input">a = <span class="ocaml-error-loc">b</span></span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-error">Error: This expression has type my_type/1
       but an expression was expected of type my_type/2
       Line 1, characters 0-20:
         Definition of type my_type/1
       Line 1, characters 0-20:
         Definition of type my_type/2
</span></code></pre>

<p>对于编译器来说第二个定义是完全独立于第一个的。所以我们是定义了两个相同名称的类型。
由于<code>a</code>在早前就定义了，因此它是属于第一个类型。但<code>b</code>是属于第二个。在这个例子中，可以
重新定义<code>a</code>使得它是属于第二个类型的。这个错误是不应该在实际编程中碰到的，除非你在
同一个模块用同一个名字定义不同类型，这显然是自找麻烦。</p>
<h3 id="This-optional-argument-cannot-be-erased">警告: This optional argument cannot be erased</h3><p>带可选参数的函数至少有一个未标签的参数。下面这个例子是有警告的：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let</span> <span class="ocaml-function">f</span> <span class="ocaml-variable">?(x = 0) ?(<span class="ocaml-error-loc">y = 0</span>) </span>= print_int (x + y)</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr">Warning 16: this optional argument cannot be erased.
</span>val f : ?x:int -&gt; ?y:int -&gt; unit = &lt;fun&gt;
</span></code></pre>

<p>这个警告只要在最后加上<code>unit</code>就可以解决：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let</span> <span class="ocaml-function">f</span> <span class="ocaml-variable">?(x = 0) ?(y = 0) () </span>= print_int (x + y)</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val f : ?x:int -&gt; ?y:int -&gt; unit -&gt; unit = &lt;fun&gt;
</span></code></pre>

<p>更多关于标签化参数请参见 <a href="labels.zh.html" title="标签">标签</a> 一章。</p>
<h3 id="The-type-of-this-expression-contains-type-variables-that-cannot-be-generalized">The type of this expression... contains type variables that cannot be generalized</h3><p>当某些情况下，编译器在到了编译单元（文件）结尾时，也无法得知类型的整个定义，并且也无法
是多态时，这个警告会产生：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let </span><span class="ocaml-variable">x</span> = <span class="keyword">ref</span> None</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val x : '_weak1 option ref = {contents = None}
</span></code></pre>

<p>这会引起下面的编译信息：</p>
<pre class="text"><code class="text">The type of this expression, &#39;_a option ref,
contains type variables that cannot be generalized</code></pre><p>解决方案：直接告诉编译器你的变量类型：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let </span>x : string option <span class="keyword">ref</span> = <span class="keyword">ref</span> None</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val x : string option ref = {contents = None}
</span></code></pre>

<p>或者：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let </span><span class="ocaml-variable">x</span> = <span class="keyword">ref</span> (None : string option)</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val x : string option ref = {contents = None}
</span></code></pre>

<p><code>&#39;_a</code>的数据类型在toplevel有可能会暂时被允许。它代表这是某个类型，但它
不是所有类型，它不是多态的（译注：也就是说它不是真的多态的，只是toplevel中的一个占位表示而已）。
在toplevel，我们的例子有下面的结果：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let </span><span class="ocaml-variable">x</span> = <span class="keyword">ref</span> None</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val x : '_weak2 option ref = {contents = None}
</span></code></pre>

<p>编译器告诉我们<code>x</code>的类型还不完全知道，但是随着<code>x</code>的使用，编译器可以推导出它的类型：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input">x := Some 0</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>- : unit = ()
</span></code></pre>

<p>现在 <code>x</code> 的类型是已知的：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input">x</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>- : int option ref = {contents = Some 0}
</span></code></pre>

<p>更多细节在 <a href="http://caml.inria.fr/pub/old_caml_site/FAQ/FAQ_EXPERT-eng.html#variables_de_types_faibles" title="http://caml.inria.fr/pub/old_caml_site/FAQ/FAQ_EXPERT-eng.html#variables_de_types_faibles">OCaml
FAQ</a>。</p>
<h2 id="">模式匹配警告和错误</h2><h3 id="This-pattern-is-unused">This pattern is unused</h3><p>这个警告其实是一个错误，因为这种代码没理由存在。这当程序员粗心地引入一个匹配所有的模式
是会产生，如下：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let</span> <span class="ocaml-function">test_memb<span class="ocaml-error-loc">er</span></span><span class="ocaml-error-loc"> </span><span class="ocaml-variable"><span class="ocaml-error-loc">x t</span>up </span>=
    <span class="keyword">match</span> tup <span class="keyword">with</span>
    | (y, _) | (_, y) when y = x -&gt; true
    | _ -&gt; false</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr">Warning 12: this sub-pattern is unused.
Line 3, characters 4-19:
Warning 57: Ambiguous or-pattern variables under guard;
variable y may match different arguments. (See manual section 9.5)
</span>val test_member : 'a -&gt; 'a * 'a -&gt; bool = &lt;fun&gt;
</span></code></pre>

<p>显然，这里程序员完全曲解了OCaml的模式匹配。记住以下几点：</p>
<ul><li>模式匹配的遍历是线性的，由上至下，从左到右。回溯是<em>根本不存在</em>的。</li><li>一个guard 不是模式的一部分。它只是一个条件语句，并且最多使用一次。它只是让你跳到下一个模式的一个手段。</li><li>小写的名字只是名字，它们会匹配任何东西的。</li></ul>

<p>在我们的例子中，显然只有第一个模式才被匹配，这导致下面的结果：</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input">test_member 1 (1, 0)</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>- : bool = true
</span><span class="ocaml-prompt"># </span><span class="ocaml-input">test_member 1 (0, 1)</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>- : bool = false
</span></code></pre>

<h3 id="This-pattern-matching-is-not-exhaustive">This pattern-matching is not exhaustive</h3><p>OCaml&#39;s pattern matching can check whether a set of patterns is
exhaustive or not, based on the <em>type</em> only. So in the following
example, the compiler doesn&#39;t know what range of ints the &quot;mod&quot; operator
would return:</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">le<span class="ocaml-error-loc">t</span></span><span class="ocaml-error-loc"> </span><span class="ocaml-function"><span class="ocaml-error-loc">is_even</span></span><span class="ocaml-error-loc"> </span><span class="ocaml-variable"><span class="ocaml-error-loc">x </span></span><span class="ocaml-error-loc">=
    </span><span class="keyword"><span class="ocaml-error-loc">match</span></span><span class="ocaml-error-loc"> x mod 2 </span><span class="keyword"><span class="ocaml-error-loc">with</span></span><span class="ocaml-error-loc">
    | 0 -&gt; true
    |</span> 1 | -1 -&gt; false</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr">Warning 8: this pattern-matching is not exhaustive.
Here is an example of a case that is not matched:
2
</span>val is_even : int -&gt; bool = &lt;fun&gt;
</span></code></pre>

<p>A short solution without pattern matching would be:</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let</span> <span class="ocaml-function">is_even</span> <span class="ocaml-variable">x </span>= x mod 2 = 0</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val is_even : int -&gt; bool = &lt;fun&gt;
</span></code></pre>

<p>In general, that kind of simplification is not possible and the best
solution is to add a catch-all case which should never be reached:</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="governing">let</span> <span class="ocaml-function">is_even</span> <span class="ocaml-variable">x </span>=
    <span class="keyword">match</span> x mod 2 <span class="keyword">with</span>
    | 0 -&gt; true
    | 1 | -1 -&gt; false
    | _ -&gt; <span class="keyword">assert</span> false</span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>val is_even : int -&gt; bool = &lt;fun&gt;
</span></code></pre>

<h2 id="Problems-recompiling-valid-programs">Problems recompiling valid programs</h2><h3 id="x-cmi-is-not-a-compiled-interface">x.cmi is not a compiled interface</h3><p>When recompiling some old program or compiling a program from an
external source that was not cleaned properly, it is possible to get
this error message:</p>
<pre class="text"><code class="text">some_module.cmi is not a compiled interface</code></pre><p>It means that some_module.cmi is not valid according to the <em>current
version</em> of the OCaml compiler. Most of the time, removing the old
compiled files (*.cmi, *.cmo, *.cmx, ...) and recompiling is
sufficient to solve this problem.</p>
<h3 id="Warning-Illegal-backslash-escape-in-string">Warning: Illegal backslash escape in string</h3><p>Recent versions of OCaml warn you against unprotected backslashes in
strings since they should be doubled. Such a message may be displayed
when compiling an older program, and can be turned off with the <code>-w x</code>
option.</p>
<pre><code class="ocamltop"><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="string">&quot;<span class="ocaml-error-loc">\e</span>\n&quot;</span> <span class="comment">(* bad practice *)</span></span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr">Warning 14: illegal backslash escape in string.
</span>- : string = &quot;\\e\n&quot;
</span><span class="ocaml-prompt"># </span><span class="ocaml-input"><span class="string">&quot;\\e\n&quot;</span> <span class="comment">(* good practice *)</span></span><span class="ocaml-prompt">;;</span><br/><span class="ocaml-output"><span class="ocaml-stdout"></span><span class="ocaml-stderr"></span>- : string = &quot;\\e\n&quot;
</span></code></pre>

      </div>
    </div>
    
    
  </div>
</div>

    
    <footer id="footer" class="navbar navbar-inverse">
      <div class="navbar-inner">
	
<div class="column">
  <div class="entry">
    <h1><a href="../../learn/">Learn</a></h1>
    <ul>
      <li><a href="../../learn/taste.html">Code Examples</a></li>
      <li><a href="../../learn/tutorials/index.zh.html">Tutorials</a></li>
      <li><a href="../../learn/books.html">Books</a></li>
      <li><a href="../../learn/success.html">Success Stories</a></li>
      <li><a href="."></a></li>
    </ul>
  </div>
</div>
<div class="column">
  <div class="entry">
    <h1><a href="../../docs/">Documentation</a></h1>
    <ul>
      <li><a href="../../docs/install.html">Install</a></li>
      <li><a href="http://caml.inria.fr/pub/docs/manual-ocaml/">Manual</a></li>
      <li><a href="https://opam.ocaml.org/packages/">Packages</a></li>
      <li><a href="../../releases/index.html">Compiler Releases</a></li>
      <li><a href="../../docs/logos.html">Logos</a></li>
    </ul>
  </div>
</div>
<div class="column">
  <div class="entry">
    <h1><a href="../../community/">Community</a></h1>
    <ul>
      <li><a href="../../community/mailing_lists.html">Mailing Lists</a></li>
      <li><a href="../../meetings/">Meetings</a></li>
      <li><a href="../../community/planet/">News</a></li>
      <li><a href="../../community/support.html">Support</a></li>
      <li><a href="http://caml.inria.fr/mantis/my_view_page.php" target="_blank">Bug Tracker</a></li>
    </ul>
  </div>
</div>

<div class="column">
  <div class="entry">
    <h1>Website</h1>
    <ul>
      <li><a href="https://github.com/ocaml/ocaml.org/tree/master/site/learn/tutorials/common_error_messages.zh.md" target="_blank">Edit this page</a></li>
      <li><a href="https://github.com/ocaml/ocaml.org/issues" target="_blank">Website Issues</a></li>
      <li><a href="../../about.html">About This Site</a></li>
    <li><a href="https://github.com/ocaml/ocaml.org/" target="_blank">Find Us on GitHub</a></li>
      <li><a href="../../contributors.html">Credits</a></li>
    </ul>
  </div>
</div>

      </div>
    </footer>
    
    
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js" type="text/javascript"></script>

     

  </body>
</html>
